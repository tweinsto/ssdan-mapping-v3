<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Race by Year – North Carolina</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 1em;
    }
    #buttons button {
      margin: 0 5px;
    }
    #chart-container {
      width: 90%;
      max-width: 800px;
      margin: auto;
    }
    
    #buttons button.active {
  background-color: dodgerblue;
  color: white;
  border: none;
  border-radius: 4px;
}

  </style>
</head>
<body>
  <h2>Race/Ethnicity Population – North Carolina</h2>

  <label for="countySelect">County:</label>
  <select id="countySelect">
    <option value="Statewide" selected>Statewide</option>
<option value="Alamance County">Alamance County</option>
<option value="Alexander County">Alexander County</option>
<option value="Alleghany County">Alleghany County</option>
<option value="Anson County">Anson County</option>
<option value="Ashe County">Ashe County</option>
<option value="Avery County">Avery County</option>
<option value="Beaufort County">Beaufort County</option>
<option value="Bertie County">Bertie County</option>
<option value="Bladen County">Bladen County</option>
<option value="Brunswick County">Brunswick County</option>
<option value="Buncombe County">Buncombe County</option>
<option value="Burke County">Burke County</option>
<option value="Cabarrus County">Cabarrus County</option>
<option value="Caldwell County">Caldwell County</option>
<option value="Camden County">Camden County</option>
<option value="Carteret County">Carteret County</option>
<option value="Caswell County">Caswell County</option>
<option value="Catawba County">Catawba County</option>
<option value="Chatham County">Chatham County</option>
<option value="Cherokee County">Cherokee County</option>
<option value="Chowan County">Chowan County</option>
<option value="Clay County">Clay County</option>
<option value="Cleveland County">Cleveland County</option>
<option value="Columbus County">Columbus County</option>
<option value="Craven County">Craven County</option>
<option value="Cumberland County">Cumberland County</option>
<option value="Currituck County">Currituck County</option>
<option value="Dare County">Dare County</option>
<option value="Davidson County">Davidson County</option>
<option value="Davie County">Davie County</option>
<option value="Duplin County">Duplin County</option>
<option value="Durham County">Durham County</option>
<option value="Edgecombe County">Edgecombe County</option>
<option value="Forsyth County">Forsyth County</option>
<option value="Franklin County">Franklin County</option>
<option value="Gaston County">Gaston County</option>
<option value="Gates County">Gates County</option>
<option value="Graham County">Graham County</option>
<option value="Granville County">Granville County</option>
<option value="Greene County">Greene County</option>
<option value="Guilford County">Guilford County</option>
<option value="Halifax County">Halifax County</option>
<option value="Harnett County">Harnett County</option>
<option value="Haywood County">Haywood County</option>
<option value="Henderson County">Henderson County</option>
<option value="Hertford County">Hertford County</option>
<option value="Hoke County">Hoke County</option>
<option value="Hyde County">Hyde County</option>
<option value="Iredell County">Iredell County</option>
<option value="Jackson County">Jackson County</option>
<option value="Johnston County">Johnston County</option>
<option value="Jones County">Jones County</option>
<option value="Lee County">Lee County</option>
<option value="Lenoir County">Lenoir County</option>
<option value="Lincoln County">Lincoln County</option>
<option value="Macon County">Macon County</option>
<option value="Madison County">Madison County</option>
<option value="Martin County">Martin County</option>
<option value="McDowell County">McDowell County</option>
<option value="Mecklenburg County">Mecklenburg County</option>
<option value="Mitchell County">Mitchell County</option>
<option value="Montgomery County">Montgomery County</option>
<option value="Moore County">Moore County</option>
<option value="Nash County">Nash County</option>
<option value="New Hanover County">New Hanover County</option>
<option value="Northampton County">Northampton County</option>
<option value="Onslow County">Onslow County</option>
<option value="Orange County">Orange County</option>
<option value="Pamlico County">Pamlico County</option>
<option value="Pasquotank County">Pasquotank County</option>
<option value="Pender County">Pender County</option>
<option value="Perquimans County">Perquimans County</option>
<option value="Person County">Person County</option>
<option value="Pitt County">Pitt County</option>
<option value="Polk County">Polk County</option>
<option value="Randolph County">Randolph County</option>
<option value="Richmond County">Richmond County</option>
<option value="Robeson County">Robeson County</option>
<option value="Rockingham County">Rockingham County</option>
<option value="Rowan County">Rowan County</option>
<option value="Rutherford County">Rutherford County</option>
<option value="Sampson County">Sampson County</option>
<option value="Scotland County">Scotland County</option>
<option value="Stanly County">Stanly County</option>
<option value="Stokes County">Stokes County</option>
<option value="Surry County">Surry County</option>
<option value="Swain County">Swain County</option>
<option value="Transylvania County">Transylvania County</option>
<option value="Tyrrell County">Tyrrell County</option>
<option value="Union County">Union County</option>
<option value="Vance County">Vance County</option>
<option value="Wake County">Wake County</option>
<option value="Warren County">Warren County</option>
<option value="Washington County">Washington County</option>
<option value="Watauga County">Watauga County</option>
<option value="Wayne County">Wayne County</option>
<option value="Wilkes County">Wilkes County</option>
<option value="Wilson County">Wilson County</option>
<option value="Yadkin County">Yadkin County</option>
<option value="Yancey County">Yancey County</option>
  </select>

  <div id="buttons">
  <button id="btn2010" onclick="updateChart(2010)">2010</button>
  <button id="btn2020" onclick="updateChart(2020)">2020</button>
</div>

  <div id="chart-container">
    <canvas id="raceChart"></canvas>
  </div>

   <script>
    let data = null;
    let chart = null;
    let currentYear = 2010;

    fetch("37.json")
      .then(res => res.json())
      .then(json => {
        data = json;
        document.getElementById("countySelect").addEventListener("change", () => updateChart(currentYear));
        updateChart(currentYear);
      });

    function updateChart(year) {
      currentYear = year;

      // Highlight selected button
      document.querySelectorAll("#buttons button").forEach(btn => btn.classList.remove("active"));
      const activeBtn = document.getElementById(`btn${year}`);
      if (activeBtn) activeBtn.classList.add("active");

      const county = document.getElementById("countySelect").value;
      const entry = data[county] && data[county][year];
      if (!entry) return;

      const races = Object.keys(entry[0]).filter(k => !["state_fips", "county", "year", "total"].includes(k));
      const values = races.map(r => entry[0][r]);

      const config = {
        type: "bar",
        data: {
          labels: races,
          datasets: [{
            label: "Population",
            data: values,
            backgroundColor: "dodgerblue"
          }]
        },
        options: {
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return value.toLocaleString();
                }
              }
            }
          }
        }
      };

      if (chart) {
        chart.destroy();
      }
      chart = new Chart(document.getElementById("raceChart"), config);
    }
  </script>
</body>
</html>
